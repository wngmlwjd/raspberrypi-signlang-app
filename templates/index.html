<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Raspberry Pi Camera Stream</title>
</head>
<body>
    <h1>Camera Stream</h1>

    <!-- 녹화 버튼 -->
    <form id="recordForm" method="POST" action="/start_recording">
        <button type="submit">번역 시작</button>
    </form>

    <!-- 녹화 상태 표시 -->
    <p id="status">대기 중</p>

    <!-- 녹화 영상 재생 -->
    <video id="recordedVideo" width="640" height="480" controls style="display:none;">
        <source id="videoSource" src="" type="video/mp4">
        브라우저가 video 태그를 지원하지 않습니다.
    </video>

    <!-- 추출된 프레임 미리보기 -->
    <div id="framesContainer" style="display:none; margin-top:20px;">
        <h3>추출된 프레임</h3>
        <div id="frames" style="display:flex; flex-wrap:wrap; gap:5px;"></div>
    </div>

    <script>
        const form = document.getElementById("recordForm");
        const statusEl = document.getElementById("status");
        const videoEl = document.getElementById("recordedVideo");
        const videoSource = document.getElementById("videoSource");
        const framesContainer = document.getElementById("framesContainer");
        const framesDiv = document.getElementById("frames");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            statusEl.textContent = "녹화 중...";
            await fetch("/start_recording", { method: "POST" });
        });

        setInterval(async () => {
            const res = await fetch("/recording_status");
            const data = await res.json();
            statusEl.textContent = data.status;

            // 영상 자동 재생
            if (data.status.includes("녹화 완료") && videoEl.style.display === "none") {
                videoSource.src = "/recorded_video";
                videoEl.style.display = "block";
                videoEl.load();
                videoEl.play();
            }

            // 프레임 미리보기 (최대 5장, 일정 간격)
            if (data.frame_count > 0 && framesContainer.style.display === "none") {
                framesContainer.style.display = "block";
                const totalFrames = data.frame_count;
                const displayCount = 5;
                const step = Math.floor(totalFrames / displayCount);

                for (let i = 0; i < totalFrames && i < displayCount * step; i += step) {
                    const img = document.createElement("img");
                    img.src = `/frames/frame_${i.toString().padStart(5, '0')}.jpg`;
                    img.width = 120;
                    framesDiv.appendChild(img);
                }
            }
        }, 1000);
    </script>
</body>
</html>
